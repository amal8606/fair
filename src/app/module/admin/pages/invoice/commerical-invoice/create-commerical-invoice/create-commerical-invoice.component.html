<div
  class="p-6 sm:p-10 mx-auto print:bg-white bg-gray-50 border border-gray-300 shadow-2xl print:border-none print:shadow-none"
>
  <header class="mb-8 text-center print:hidden">
    <p class="text-3xl font-bold text-blue-500">COMMERCIAL INVOICE CREATOR</p>
    <p class="text-gray-600 mt-2">
      Step {{ currentStep }} of {{ totalSteps }}:
      <span *ngIf="currentStep === 1">Select Purchase Order</span>
      <span *ngIf="currentStep === 2">Enter Details & Confirm Items</span>
      <span *ngIf="currentStep === 3">Review & Print Invoice</span>
    </p>
    <div class="h-2 bg-gray-200 rounded-full mt-4">
      <div
        class="h-full bg-blue rounded-full transition-all duration-500"
        [style.width]="(currentStep / totalSteps) * 100 + '%'"
      ></div>
    </div>
  </header>

  <form [formGroup]="commercialInvoiceForm" class="space-y-8">
    <section *ngIf="currentStep === 1">
      <p class="text-xl font-semibold mb-4 text-blue-500">
        Select Invoicable Purchase Order
      </p>
      <div
        *ngIf="isLoading"
        class="absolute inset-0 h-full flex items-center justify-center bg-white bg-opacity-80 z-10"
      >
        <p class="text-sm font-medium text-blue">Loading PO Details...</p>
      </div>

      <div
        class="overflow-x-auto border rounded-lg print:shadow-none shadow-md"
      >
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                PO Number
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Customer
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Date Created
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Action
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngIf="incomingPOs.length === 0 && isPoLoading === false">
              <td
                colspan="4"
                class="px-6 py-4 text-center text-sm text-gray-500"
              >
                No incoming Purchase Orders found.
              </td>
            </tr>
            <tr *ngIf="isPoLoading">
              <td
                colspan="4"
                class="px-6 py-4 text-center text-sm text-gray-500"
              >
                <p class="no-data-row text-center text-gray-500">
                  <span>Loading Data </span>
                  <span class="loading-dots">
                    <span class="dot">.</span>
                    <span class="dot">.</span>
                    <span class="dot">.</span>
                  </span>
                </p>
              </td>
            </tr>
            <tr *ngFor="let po of incomingPOs" class="hover:bg-blue-50">
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
              >
                {{ po.poNumber }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                {{ orgId(po.buyerOrgId) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ po.orderDate | date : "shortDate" }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button
                  type="button"
                  (click)="selectPO(po)"
                  class="px-3 py-1 bg-blue text-white text-xs font-semibold rounded-md shadow-md print:shadow-none hover:bg-blue-600 bg-blue-500 transition duration-150"
                  [disabled]="isLoading"
                >
                  Select PO
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <input type="hidden" formControlName="selectedPoNumber" />

      <div
        *ngIf="
          commercialInvoiceForm.get('selectedPoNumber')?.invalid &&
          commercialInvoiceForm.get('selectedPoNumber')?.touched
        "
        class="text-red-600 text-sm mt-2"
      >
        Please select a Purchase Order to continue to the next step.
      </div>
    </section>

    <section *ngIf="currentStep === 2">
      <p class="text-4xl font-semibold mb-4 text-blue-500">Invoice Details</p>

      <p class="text-xl font-semibold mb-4 text-blue-400">Reference Details</p>
      <div
        class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 mb-4 border p-2 rounded-sm"
      >
        <div class="space-y-1">
          <label
            for="commercialInvoiceNumber"
            class="block text-sm font-medium text-gray-700"
            >Invoice Number</label
          >
          <input
            id="commercialInvoiceNumber"
            formControlName="commercialInvoiceNumber"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
          <div
            *ngIf="
              commercialInvoiceForm.get('commercialInvoiceNumber')?.invalid &&
              commercialInvoiceForm.get('commercialInvoiceNumber')?.touched
            "
            class="text-red-600 text-xs mt-1"
          >
            Invoice Number is required.
          </div>
        </div>

        <div class="space-y-1">
          <label for="createdAt" class="block text-sm font-medium text-gray-700"
            >Date</label
          >
          <input
            id="createdAt"
            formControlName="createdAt"
            type="date"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
          <div
            *ngIf="
              commercialInvoiceForm.get('invoiceDate')?.invalid &&
              commercialInvoiceForm.get('invoiceDate')?.touched
            "
            class="text-red-600 text-xs mt-1"
          >
            Date is required.
          </div>
        </div>
        <div class="space-y-1">
          <label
            for="finalDestination"
            class="block text-sm font-medium text-gray-700"
            >Final Destination</label
          >
          <input
            id="finalDestination"
            formControlName="finalDestination"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
        </div>

        <div class="space-y-1">
          <label
            for="termsOfSale"
            class="block text-sm font-medium text-gray-700"
            >Terms of Sale</label
          >
          <input
            id="termsOfSale"
            formControlName="termsOfSale"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            required
          />
          <div
            *ngIf="
              commercialInvoiceForm.get('termsOfSale')?.invalid &&
              commercialInvoiceForm.get('termsOfSale')?.touched
            "
            class="text-red-600 text-xs mt-1"
          >
            Required.
          </div>
        </div>
        <div class="space-y-1">
          <label
            for="termsOfPayment"
            class="block text-sm font-medium text-gray-700"
            >Terms of Payment</label
          >
          <input
            id="termsOfPayment"
            formControlName="termsOfPayment"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            required
          />
          <div
            *ngIf="
              commercialInvoiceForm.get('termsOfPayment')?.invalid &&
              commercialInvoiceForm.get('termsOfPayment')?.touched
            "
            class="text-red-600 text-xs mt-1"
          >
            Required.
          </div>
        </div>
        <div class="space-y-1">
          <label
            for="termsOfShipping"
            class="block text-sm font-medium text-gray-700"
            >Terms of Shipping</label
          >
          <input
            id="termsOfShipping"
            formControlName="termsOfShipping"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            required
          />
          <div
            *ngIf="
              commercialInvoiceForm.get('termsOfShipping')?.invalid &&
              commercialInvoiceForm.get('termsOfShipping')?.touched
            "
            class="text-red-600 text-xs mt-1"
          >
            Required.
          </div>
        </div>

        <div class="space-y-1">
          <label for="currency" class="block text-sm font-medium text-gray-700"
            >Currency</label
          >
          <input
            id="currency"
            formControlName="currency"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            readonly
          />
        </div>
        <div class="space-y-1">
          <label
            for="modeOfTransport"
            class="block text-sm font-medium text-gray-700"
            >Mode of Transport</label
          >
          <input
            id="modeOfTransport"
            formControlName="modeOfTransport"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
        </div>
        <div class="space-y-1">
          <label
            for="placeOfReceipt"
            class="block text-sm font-medium text-gray-700"
            >Place Of Receipt</label
          >
          <input
            id="placeOfReceipt"
            formControlName="placeOfReceipt"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
        </div>
      </div>

      <p class="text-xl font-semibold mt-4 text-blue-400">
        Shipper Information
      </p>

      <div
        class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 border p-2 rounded-sm"
      >
        <div class="space-y-1">
          <label
            for="customerId"
            class="block text-sm font-medium text-gray-700"
            >Customer</label
          >
          <select
            id="customerId"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            formControlName="customerId"
            required
          >
            <option [value]="null" disabled selected>Select Customer</option>
            <option
              *ngFor="let customer of customers"
              [value]="customer.organizationId"
            >
              {{ customer?.name }}
            </option>
          </select>
          <div
            *ngIf="
              commercialInvoiceForm.get('customerId')?.invalid &&
              commercialInvoiceForm.get('customerId')?.touched
            "
            class="text-red-600 text-xs mt-1"
          >
            Customer is required.
          </div>
        </div>
        <div class="space-y-1">
          <label
            for="contactName"
            class="block text-sm font-medium text-gray-700"
            >Contact Name</label
          >
          <input
            id="contactName"
            formControlName="contactName"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
        </div>
        <div class="space-y-1">
          <label for="contactNo" class="block text-sm font-medium text-gray-700"
            >Contact No</label
          >
          <input
            id="contactNo"
            formControlName="contactNo"
            type="number"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
        </div>
        <div class="space-y-1">
          <label for="email" class="block text-sm font-medium text-gray-700"
            >Email</label
          >
          <input
            id="email"
            formControlName="email"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
        </div>
        <div class="space-y-1">
          <label for="taxId" class="block text-sm font-medium text-gray-700"
            >Tax Id</label
          >
          <input
            id="taxId"
            formControlName="taxId"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
        </div>
        <div class="space-y-1">
          <label for="ein" class="block text-sm font-medium text-gray-700"
            >EIN</label
          >
          <input
            id="ein"
            formControlName="ein"
            type="text"
            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
          />
        </div>
        <div
          formGroupName="invoiceDetails"
          class="grid col-span-3 grid-cols-1 md:grid-cols-2 gap-4 mt-4"
        >
          <div class="space-y-1">
            <label
              for="customerAddressSelect"
              class="block text-sm font-medium text-gray-700"
              >Select Customer Address</label
            >

            <select
              id="customerAddressSelect"
              (change)="onCustomerAddressSelect($event)"
              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            >
              <option value="" disabled selected>
                Select or Review Address
              </option>
              <option
                *ngFor="let addr of customerAddresses"
                [value]="addr.addressId"
              >
                {{ addr.addressLine1 }} ({{ addr.addressType }})
              </option>
            </select>

            <label
              for="customerAddress"
              class="block text-sm font-medium text-gray-700 mt-2"
              >Customer Address (Editable)</label
            >
            <textarea
              id="customerAddress"
              formControlName="customerAddress"
              rows="3"
              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            ></textarea>

            <div
              *ngIf="
                commercialInvoiceForm.get('invoiceDetails.customerAddress')
                  ?.invalid &&
                commercialInvoiceForm.get('invoiceDetails.customerAddress')
                  ?.touched
              "
              class="text-red-600 text-xs mt-1"
            >
              Customer Address is required.
            </div>
          </div>
          <div class="space-y-1">
            <label
              for="shipToAddressSelect"
              class="block text-sm font-medium text-gray-700"
              >Select Shipping Address</label
            >

            <select
              id="shipToAddressSelect"
              (change)="onShipToAddressSelect($event)"
              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            >
              <option value="" disabled selected>
                Select or Review Address
              </option>
              <option
                *ngFor="let addr of customerAddresses"
                [value]="addr.addressId"
              >
                {{ addr.addressLine1 }} ({{ addr.addressType }})
              </option>
            </select>

            <label
              for="shipToAddress"
              class="block text-sm font-medium text-gray-700 mt-2"
              >Shipping To Address (Editable)</label
            >
            <textarea
              id="shipToAddress"
              formControlName="shipToAddress"
              rows="3"
              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
            ></textarea>

            <div
              *ngIf="
                commercialInvoiceForm.get('invoiceDetails.shipToAddress')
                  ?.invalid &&
                commercialInvoiceForm.get('invoiceDetails.shipToAddress')
                  ?.touched
              "
              class="text-red-600 text-xs mt-1"
            >
              Customer Address is required.
            </div>
          </div>
        </div>
      </div>

      <p class="text-lg font-semibold my-4 text-blue-500">Line Items</p>

      <div
        class="overflow-x-auto border rounded-lg shadow-sm print:shadow-none"
      >
        <div formArrayName="commercialInvoiceItems">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-10"
                >
                  LIN
                </th>
                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-48"
                >
                  Part Number
                </th>
                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-20"
                >
                  UI
                </th>
                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                >
                  Description
                </th>
                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-20"
                >
                  PO#
                </th>
                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-20"
                >
                  COUNTRY OF ORIGIN
                </th>
                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-20"
                >
                  Qty
                </th>

                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-24"
                >
                  Unit Price
                </th>
                <th
                  class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-24"
                >
                  TOTAL PRICE
                </th>
                <th class="px-3 py-2 w-10"></th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr
                *ngFor="
                  let itemGroup of commercialInvoiceItemsArray.controls;
                  let i = index
                "
                [formGroupName]="i"
              >
                <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">
                  {{ i + 1 }}
                </td>
                <td class="px-3 py-2 text-sm text-gray-700">
                  <input
                    formControlName="partNumber"
                    type="text"
                    placeholder="Part Number"
                    class="w-full border-gray-300 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500"
                  />
                </td>
                <td class="px-3 py-2">
                  <input
                    formControlName="ui"
                    type="text"
                    class="w-20 border-gray-300 rounded-md text-sm text-right focus:border-blue-500 focus:ring-blue-500"
                  />
                  <div
                    *ngIf="
                      itemGroup.get('ui')?.invalid &&
                      itemGroup.get('ui')?.touched
                    "
                    class="text-red-600 text-xs mt-1"
                  >
                    Req
                  </div>
                </td>
                <td class="px-3 py-2">
                  <textarea
                    formControlName="description"
                    rows="2"
                    class="w-full border-gray-300 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500"
                  ></textarea>
                  <div
                    *ngIf="
                      itemGroup.get('description')?.invalid &&
                      itemGroup.get('description')?.touched
                    "
                    class="text-red-600 text-xs mt-1"
                  >
                    Req
                  </div>
                </td>
                <td class="px-3 py-2">
                  <input
                    formControlName="poNumber"
                    type="text"
                    class="w-20 border-gray-300 rounded-md text-sm text-right focus:border-blue-500 focus:ring-blue-500"
                  />
                  <div
                    *ngIf="
                      itemGroup.get('poNumber')?.invalid &&
                      itemGroup.get('poNumber')?.touched
                    "
                    class="text-red-600 text-xs mt-1"
                  >
                    Req
                  </div>
                </td>

                <td class="px-3 py-2">
                  <input
                    formControlName="countryOfOrigin"
                    type="text"
                    class="w-24 border-gray-300 rounded-md text-sm text-right focus:border-blue-500 focus:ring-blue-500"
                  />
                  <div
                    *ngIf="
                      itemGroup.get('countryOfOrigin')?.invalid &&
                      itemGroup.get('countryOfOrigin')?.touched
                    "
                    class="text-red-600 text-xs mt-1"
                  >
                    Req
                  </div>
                </td>

                <td class="px-3 py-2">
                  <input
                    formControlName="quantity"
                    type="number"
                    min="1"
                    (input)="calculateTotalPrice(itemGroup)"
                    class="w-20 border-gray-300 rounded-md text-sm text-right focus:border-blue-500 focus:ring-blue-500"
                  />
                  <div
                    *ngIf="
                      itemGroup.get('quantity')?.invalid &&
                      itemGroup.get('quantity')?.touched
                    "
                    class="text-red-600 text-xs mt-1"
                  >
                    Req
                  </div>
                </td>

                <td class="px-3 py-2">
                  <input
                    formControlName="unitPrice"
                    type="number"
                    min="0"
                    (input)="calculateTotalPrice(itemGroup)"
                    class="w-24 border-gray-300 rounded-md text-sm text-right focus:border-blue-500 focus:ring-blue-500"
                  />
                  <div
                    *ngIf="
                      itemGroup.get('unitPrice')?.invalid &&
                      itemGroup.get('unitPrice')?.touched
                    "
                    class="text-red-600 text-xs mt-1"
                  >
                    Req
                  </div>
                </td>
                <td
                  class="px-3 py-2 whitespace-nowrap text-sm font-medium text-right"
                >
                  <input
                    formControlName="totalPrice"
                    type="text"
                    [disabled]="true"
                    class="w-24 border-gray-300 rounded-md text-sm text-right bg-gray-100"
                  />
                </td>
                <td class="px-3 py-2">
                  <button
                    type="button"
                    (click)="commercialInvoiceItemsArray.removeAt(i)"
                    class="text-red-600 hover:text-red-900 text-sm"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="currentColor"
                      class="w-4 h-4"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M16.5 4.475C16.5 3.65 15.825 3 15 3h-6c-.825 0-1.5.65-1.5 1.475v.525H3v1.5h18v-1.5h-5.5v-.525zM17 7H7v12c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V7z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="flex justify-end mt-4">
        <div class="w-full md:w-1/3 space-y-2">
          <div class="flex justify-between items-center">
            <label class="block text-sm font-medium text-gray-700"
              >Subtotal</label
            >
            <input
              type="text"
              [value]="
                commercialInvoiceForm.get('totalAmount')?.value
                  | currency
                    : commercialInvoiceForm.get('currency')?.value
                    : 'symbol'
                    : '1.2-2'
              "
              [disabled]="true"
              class="w-36 text-right border-gray-300 rounded-md shadow-sm bg-gray-100"
            />
          </div>

          <div class="flex justify-between items-center">
            <label
              for="taxableAmount"
              class="block text-sm font-medium text-gray-700"
              >Taxable Amount</label
            >
            <input
              id="taxableAmount"
              formControlName="taxableAmount"
              type="number"
              min="0"
              (input)="calculateGrandTotal()"
              class="w-36 text-right border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500"
            />
          </div>

          <div class="flex justify-between items-center">
            <label
              for="shippingCharge"
              class="block text-sm font-medium text-gray-700"
              >Shipping Charge</label
            >
            <input
              id="shippingCharge"
              formControlName="shippingCharge"
              type="number"
              min="0"
              (input)="calculateGrandTotal()"
              class="w-36 text-right border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500"
            />
          </div>

          <div
            class="flex justify-between items-center pt-2 border-t border-gray-300"
          >
            <label class="block text-lg font-bold text-gray-900"
              >Grand Total</label
            >
            <input
              type="text"
              [value]="
                commercialInvoiceForm.get('grandTotal')?.value
                  | currency
                    : commercialInvoiceForm.get('currency')?.value
                    : 'symbol'
                    : '1.2-2'
              "
              [disabled]="true"
              class="w-36 text-right border-gray-300 rounded-md shadow-sm bg-blue-50 text-lg font-bold text-blue-800"
            />
            <input type="hidden" formControlName="grandTotal" />
          </div>
        </div>
      </div>
      <div class="space-y-1 mt-6">
        <label for="note" class="block text-sm font-medium text-gray-700"
          >Note</label
        >
        <textarea
          id="note"
          formControlName="note"
          rows="3"
          class="mt-1 block w-full border-gray-300 rounded-md shadow-sm print:shadow-none focus:border-blue-500 focus:ring-blue-500"
        ></textarea>
      </div>
    </section>

    <section *ngIf="currentStep === 3">
      <p class="text-xl font-semibold mb-4 text-blue-600 print:hidden">
        Review & Print
      </p>

      <div
        *ngIf="finalCommercialInvoiceData"
        class="p-8 bg-white rounded-none border-none text-gray-900 font-[Arial] leading-tight print:p-4 print:text-[9pt] print:text-black-or-dark-green"
        style="font-size: 10pt"
      >
        <div
          class="text-center text-2xl text-[#a5b98b] font-bold mb-4 print:text-[16pt]"
        >
          <p>COMMERCIAL INVOICE</p>
        </div>
        <div class="flex justify-between items-start mb-4 print:mb-2">
          <div class="flex flex-col gap-x-3">
            <span
              class="text-lg print:text-base font-semibold px-1 print:text-white text-white bg-[#a5b98b]"
            >
              REFERENCE DETAILS
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              DATE -
              {{ finalCommercialInvoiceData.createdAt | date : "mediumDate" }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              INVOICE NUMBER -
              {{ finalCommercialInvoiceData.commercialInvoiceNumber }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              TERMS OF SALE - {{ finalCommercialInvoiceData.termsOfSale }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              FINAL DESTINATION -
              {{ finalCommercialInvoiceData.finalDestination }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              CURRENCY OF SALE - {{ finalCommercialInvoiceData.currency }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              MODE OF TRANSPORT -
              {{ finalCommercialInvoiceData.modeOfTransport }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              TERMS OF SHIPPING -
              {{ finalCommercialInvoiceData.termsOfShipping }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              PLACE OF RECEIPT - {{ finalCommercialInvoiceData.placeOfReceipt }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              TERMS OF PAYMENT - {{ finalCommercialInvoiceData.termsOfPayment }}
            </span>
          </div>
          <div>
            <div>
              <img
                src="../../../../../../../assets/FMLogo.jpg"
                alt="FM Logo"
                class=""
              />
            </div>
          </div>

          <div class="flex flex-col">
            <span
              class="text-lg print:text-base font-semibold px-1 print:text-white text-white bg-[#a5b98b]"
            >
              SHIPPER INFORMATION
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              TAX ID - {{ finalCommercialInvoiceData.taxId }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              EIN - {{ finalCommercialInvoiceData.ein }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              COMPANY -{{ finalCommercialInvoiceData.sellerName }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              Contact Name - {{ finalCommercialInvoiceData.contactName }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              {{ finalCommercialInvoiceData.sellerAddress }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              Contact No - {{ finalCommercialInvoiceData.contactNo }}
            </span>
            <span
              class="font-semibold print:font-light text-sm print:text-xs px-1"
            >
              E-mail - {{ finalCommercialInvoiceData.email }}
            </span>
          </div>
        </div>

        <div
          class="grid grid-cols-3 gap-4 mb-4 text-sm print:border-gray-400 py-2 print:text-[8pt]"
        >
          <div>
            <p
              class="text-lg font-semibold px-1 print:text-white text-white bg-[#a5b98b]"
            >
              CUSTOMER
            </p>
            <div class="whitespace-pre-wrap">
              <p class="font-semibold">
                {{ finalCommercialInvoiceData.customerName }}
              </p>
              <p>
                {{ finalCommercialInvoiceData.customerAddress }}
              </p>
              <p>Phone#: {{ finalCommercialInvoiceData.customerPhone }}</p>
            </div>
          </div>
          <div>
            <p
              class="text-lg font-semibold px-1 print:text-white text-white bg-[#a5b98b]"
            >
              SHIP TO
            </p>
            <div class="whitespace-pre-wrap">
              <p class="font-semibold">
                {{ finalCommercialInvoiceData.customerName }}
              </p>
              <p>{{ finalCommercialInvoiceData.shipToAddress }}</p>
            </div>
          </div>
          <div>
            <p
              class="text-lg font-semibold px-1 print:text-white text-white bg-[#a5b98b]"
            >
              FREIGHT INFO
            </p>
            <div class="whitespace-pre-wrap">
              <p>TOTAL NUMBER OF PACKAGES</p>
            </div>
          </div>
        </div>

        <div
          class="border rounded-lg overflow-hidden mb-4 print:border-gray-400"
        >
          <table
            class="min-w-full divide-y print:divide-black text-sm print:text-[8pt]"
          >
            <thead class="bg-[#a5b98b]">
              <tr>
                <th
                  class="p-1 text-left font-bold text-white uppercase w-10 border-r print:border-gray-400"
                >
                  LN#
                </th>
                <th
                  class="p-1 text-left font-bold text-white uppercase w-24 border-r border-gray-400"
                >
                  PART NUMBER
                </th>
                <th
                  class="p-1 text-left font-bold text-white uppercase w-24 border-r border-gray-400"
                >
                  UI
                </th>
                <th
                  class="p-1 text-left font-bold text-white uppercase border-r border-gray-400"
                >
                  DESCRIPTION
                </th>
                <th
                  class="p-1 text-left font-bold text-white uppercase w-24 border-r border-gray-400"
                >
                  PO#
                </th>
                <th
                  class="p-1 text-left font-bold text-white uppercase w-24 border-r border-gray-400"
                >
                  COUNTRY OF ORIGIN
                </th>
                <th
                  class="p-1 text-right font-bold text-white uppercase w-12 border-r border-gray-400"
                >
                  QTY
                </th>
                <th
                  class="p-1 text-right font-bold text-white uppercase w-24 border-r border-gray-400"
                >
                  UNIT PRICE
                </th>
                <th
                  class="p-1 text-right font-bold text-white uppercase w-24 border-r border-gray-400"
                >
                  Total AMOUNT
                </th>
              </tr>
            </thead>
            <tbody
              class="bg-white divide-y print:divide-[#a5b98b] print:border-[#a5b98b]"
            >
              <tr
                *ngFor="
                  let item of finalCommercialInvoiceData.items;
                  let i = index
                "
                class=""
              >
                <td class="p-1 align-top border border-gray-400">
                  {{ i + 1 }}
                </td>
                <td class="p-1 align-top border border-gray-400">
                  {{ item.partNumber }}
                </td>
                <td class="p-1 align-top border border-gray-400">
                  {{ item.ui }}
                </td>
                <td class="p-1 align-top border border-gray-400">
                  <p class="font-medium">
                    {{ item.description }}
                  </p>
                </td>
                <td class="p-1 align-top border border-gray-400">
                  {{ item.poNumber }}
                </td>
                <td class="p-1 align-top border border-gray-400">
                  {{ item.countryOfOrigin }}
                </td>
                <td class="p-1 align-top text-right border border-gray-400">
                  {{ item.quantity }}
                </td>
                <td class="p-1 align-top text-right border border-gray-400">
                  {{
                    item.unitPrice
                      | currency
                        : finalCommercialInvoiceData.totals.currency
                        : "symbol"
                        : "1.2-2"
                  }}
                </td>
                <td
                  class="p-1 align-top text-right font-semibold border border-gray-400"
                >
                  {{
                    item.totalPrice
                      | currency
                        : finalCommercialInvoiceData.totals.currency
                        : "symbol"
                        : "1.2-2"
                  }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="flex gap-3 justify-between">
          <div
            class="border border-gray-400 print:border-gray-400 print:text-[8pt] h-24 print:h-16 w-3/5 flex flex-col"
          >
            <div class="bg-[#a5b98b] px-2 py-1">
              <p class="font-semibold bg text-white">Declaration Statement</p>
            </div>
            <div class="px-2">
              <p
                class="print:text-xs text-sm text-gray-600 print:text-black mt-5"
              >
                I certify that the information on this invoice is true and
                correct, and the content and value of the shipment as stated
                above.
              </p>
            </div>
          </div>
          <div class="w-1/3">
            <table
              class="w-full border-collapse border border-gray-400 text-sm print:text-[8pt]"
            >
              <tbody>
                <tr>
                  <td class="p-1 border border-gray-400 font-semibold w-1/2">
                    Subtotal
                  </td>
                  <td
                    class="p-1 border border-gray-400 text-right font-bold w-1/2"
                  >
                    {{
                      finalCommercialInvoiceData.totals.subTotal
                        | currency
                          : finalCommercialInvoiceData.totals.currency
                          : "symbol"
                          : "1.2-2"
                    }}
                  </td>
                </tr>
                <tr>
                  <td class="p-1 border border-gray-400 font-semibold w-1/2">
                    Taxable
                  </td>
                  <td
                    class="p-1 border border-gray-400 text-right font-bold w-1/2"
                  >
                    {{
                      finalCommercialInvoiceData.totals.taxableAmount
                        | currency
                          : finalCommercialInvoiceData.totals.currency
                          : "symbol"
                          : "1.2-2"
                    }}
                  </td>
                </tr>
                <tr>
                  <td class="p-1 border border-gray-400 font-semibold w-1/2">
                    Shipping Charge
                  </td>
                  <td
                    class="p-1 border border-gray-400 text-right font-bold w-1/2"
                  >
                    {{
                      finalCommercialInvoiceData.totals.shippingCharge
                        | currency
                          : finalCommercialInvoiceData.totals.currency
                          : "symbol"
                          : "1.2-2"
                    }}
                  </td>
                </tr>
                <tr class="">
                  <td class="p-1 border border-gray-400 font-bold text-white">
                    Grand Total
                  </td>
                  <td
                    class="p-1 border border-gray-400 text-right font-bold w-1/2 text-white"
                  >
                    {{
                      finalCommercialInvoiceData.totals.grandTotal
                        | currency
                          : finalCommercialInvoiceData.totals.currency
                          : "symbol"
                          : "1.2-2"
                    }}
                  </td>
                </tr>
                <tr>
                  <td class="p-1 border border-gray-400 font-semibold">
                    Currency
                  </td>
                  <td class="p-1 border border-gray-400 text-right">
                    {{ finalCommercialInvoiceData.totals.currency }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="flex justify-end text-sm mt-8 print:mt-4">
          <div class="w-1/3 text-center mr-8">
            <div class="border-b print:border-[#a5b98b] pt-1 mb-1">
              {{ finalCommercialInvoiceData.signerName }}
            </div>
            <div class="text-xs text-gray-500 print:text-[#a5b98b]">
              FAIRMOUNT INTERNATIONAL LLC
            </div>
          </div>
          <div class="w-1/3 text-center">
            <div class="border-b print:border-[#a5b98b] pt-1 mb-1">
              {{ finalCommercialInvoiceData.signDate }}
            </div>
            <div class="text-xs text-gray-500 print:text-[#a5b98b]">Date</div>
          </div>
        </div>
      </div>
    </section>

    <div
      class="flex justify-between pt-6 border-t border-gray-300 print:hidden"
    >
      <button
        type="button"
        (click)="prevStep()"
        [disabled]="currentStep === 1"
        class="px-6 py-2 bg-gray-400 text-white font-semibold rounded-md shadow-md print:shadow-none hover:bg-gray-500 disabled:opacity-50"
      >
        &larr; Previous
      </button>

      <div class="flex flex-col space-y-2 items-end">
        <div class="flex space-x-4">
          <button
            *ngIf="currentStep === totalSteps"
            (click)="postInvoice()"
            type="button"
            [disabled]="generateLoding"
            class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-md print:shadow-none hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed"
          >
            <span *ngIf="!generateLoding">Generate Commercial Invoice</span>
            <span *ngIf="generateLoding"> Generating... </span>
          </button>
          <button
            *ngIf="currentStep === totalSteps"
            (click)="printCommercialInvoice()"
            type="button"
            class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-md print:shadow-none hover:bg-blue-700"
          >
            Print Commercial Invoice
          </button>
        </div>

        <button
          *ngIf="currentStep < totalSteps"
          type="button"
          (click)="nextStep()"
          [disabled]="
            currentStep === 1 &&
            !commercialInvoiceForm.get('selectedPoNumber')?.value
          "
          class="px-6 py-2 bg-blue-500 text-white font-semibold rounded-md shadow-md print:shadow-none hover:bg-blue-600 disabled:opacity-50"
        >
          {{
            currentStep === 1
              ? "Next: Enter Details →"
              : "Review & Generate Invoice →"
          }}
        </button>
      </div>
    </div>
  </form>
</div>
