<div
  class="fixed flex items-center justify-center bg-gray-400/30 top-0 left-0 right-0 z-50 w-full p-4 overflow-x-hidden overflow-y-auto sm:inset-0 h-[calc(100%-1rem)] md:h-full scrollbar-hide"
  (click)="closeModel()"
>
  <div
    (click)="$event.stopPropagation()"
    class="relative h-full w-full max-w-7xl max-h-[650px] overflow-y-scroll rounded-lg no-scrollbar"
  >
    <!-- Modal content -->
    <div class="relative bg-white rounded-lg shadow mt-50">
      <!-- Modal header -->
      <div class="flex justify-between p-6 border-b rounded-t bg-blue-200">
        <p
          class="text-[1rem] flex mb-0 items-center font-semibold text-gray-900"
        >
          Fairmount LLC
        </p>
        <button
          type="button"
          class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center"
          (click)="closeModel()"
        >
          <svg
            aria-hidden="true"
            class="w-5 h-5"
            fill="currentColor"
            viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            ></path>
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>
      <!-- Modal body -->
      <div class="px-6 mt-4">
        <div class="space-y-4 text-sm text-gray-700">
          <div class="flex flex-col justify-between gap-8">
            <div>
              <button
                (click)="addItemModel = !addItemModel"
                class="bg-green-500 text-white px-4 py-2 rounded mb-4"
              >
                Add New Item
              </button>
            </div>

            <!-- ADD ITEMS SECTION -->
            <form [formGroup]="addPOItemForm">
              <div *ngIf="addItemModel">
                <div class="grid grid-cols-4 gap-4 mb-4">
                  <div class="flex flex-col">
                    <label for="">Quantity</label>
                    <input
                      formControlName="quantity"
                      type="number"
                      class="border rounded px-2 py-2"
                    />
                  </div>
                  <div class="flex flex-col">
                    <label for="">Unit</label>
                    <input
                      formControlName="unit"
                      type="text"
                      class="border rounded px-2 py-2"
                    />
                  </div>
                  <div class="flex flex-col">
                    <label for="">Description</label>
                    <input
                      formControlName="description"
                      type="text"
                      class="border rounded px-2 py-2"
                    />
                  </div>
                  <div class="flex flex-col">
                    <label for="">Unit Price</label>
                    <input
                      formControlName="unitPrice"
                      type="number"
                      class="border rounded px-2 py-2"
                    />
                  </div>
                  <div class="flex flex-col">
                    <label for="">Actual Cost Per Unit</label>
                    <input
                      formControlName="actualCostPerUnit"
                      type="number"
                      class="border rounded px-2 py-2"
                    />
                  </div>

                  <div class="flex flex-col">
                    <label for="">Part #</label>
                    <input
                      formControlName="partNumber"
                      type="text"
                      class="border rounded px-2 py-2"
                    />
                  </div>
                  <div class="flex flex-col">
                    <label for="">Trace</label>
                    <select
                      formControlName="traceabilityRequired"
                      class="px-2 py-2 border-2 rounded-sm"
                      name="trace"
                      id=""
                    >
                      <option value="" disabled selected>Select trace</option>
                      <option [value]="1">yes</option>
                      <option [value]="0">no</option>
                    </select>
                  </div>
                  <div class="flex flex-col">
                    <label for="">Manufacturer Model</label>
                    <input
                      formControlName="manufacturerModel"
                      type="text"
                      class="border rounded px-2 py-2"
                    />
                  </div>
                  <div class="flex flex-col">
                    <label for="">Terms</label>
                    <input
                      formControlName="terms"
                      type="text"
                      class="border rounded px-2 py-2"
                    />
                  </div>
                </div>
                <div class="w-[20%] flex gap-2 items-end">
                  <button
                    (click)="onSubmit()"
                    [disabled]="isAdding || addPOItemForm.invalid"
                    class="bg-green-500 disabled:bg-green-200 disabled:cursor-not-allowed text-white px-4 py-2 rounded mt-6"
                  >
                    <ng-container *ngIf="!isAdding"> Add Item </ng-container>

                    <ng-container *ngIf="isAdding">
                      <span>Adding </span>
                      <span class="loading-dots">
                        <span class="dot">.</span>
                        <span class="dot">.</span>
                        <span class="dot">.</span>
                      </span>
                    </ng-container>
                  </button>
                  <button
                    (click)="closeItemModel()"
                    class="bg-gray-500 text-white px-4 py-2 rounded mt-6"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </form>

            <div class="overflow-x-auto">
              <table class="min-w-full border text-xs mb-4">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="border px-2 py-1">ORDER DATE</th>
                    <th class="border px-2 py-1">MODE OF SHIPMENT</th>
                    <th class="border px-2 py-1">DELIVERY SCHEDULE</th>
                    <th class="border px-2 py-1">TERMS</th>
                    <!-- <th class="border px-2 py-1">ACTIONS</th> -->
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="border px-2 py-1">
                      {{ po.orderDate | date : "dd/MM/yyyy" }}
                      <!-- <input type="date" [(ngModel)]="po.orderDate" class="border rounded px-2 py-1 w-32" /> -->
                    </td>
                    <td class="border px-2 py-1">
                      {{ po.modeOfShipment }}
                      <!-- <input [(ngModel)]="po.modeOfShipment" class="border rounded px-2 py-1 w-32" /> -->
                    </td>
                    <td class="border px-2 py-1">
                      {{ po.deliverySchedule }}
                      <!-- <input [(ngModel)]="po.deliverySchedule" class="border rounded px-2 py-1 w-32" /> -->
                    </td>
                    <td class="border px-2 py-1">
                      {{ po.terms }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full border text-xs">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="border px-2 py-1">LN#</th>
                    <th class="border px-2 py-1">QTY</th>
                    <th class="border px-2 py-1">UNIT</th>
                    <th class="border px-2 py-1">DESCRIPTION</th>
                    <th class="border px-2 py-1">MFR/MODEL</th>
                    <th class="border px-2 py-1">PART #</th>
                    <th class="border px-2 py-1">TERMS</th>
                    <th class="border px-2 py-1">TRACEABILITY REQUIREMENT</th>
                    <th class="border px-2 py-1">UNIT PRICE ($)</th>
                    <th class="border px-2 py-1">ACTUAL COST PER UNIT ($)</th>
                    <th class="border px-2 py-1">TOTAL ($)</th>
                    <th class="border px-3 py-2">ACTIONS</th>
                  </tr>
                </thead>
                <tbody *ngIf="!loading">
                  <tr *ngFor="let item of productItems; let i = index">
                    <td class="border px-2 py-1">
                      {{ i + 1 }}
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container *ngIf="editingIndex === i; else readQty">
                        <input
                          type="number"
                          [(ngModel)]="item.quantity"
                          class="border rounded px-2 py-1 w-16"
                        />
                      </ng-container>
                      <ng-template #readQty>{{ item.quantity }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container *ngIf="editingIndex === i; else readUnit">
                        <input
                          [(ngModel)]="item.unit"
                          class="border rounded px-2 py-1 w-16"
                        />
                      </ng-container>
                      <ng-template #readUnit>{{ item.unit }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container *ngIf="editingIndex === i; else readDesc">
                        <input
                          [(ngModel)]="item.description"
                          class="border rounded px-2 py-1 w-32"
                        />
                      </ng-container>
                      <ng-template #readDesc>{{
                        item.description
                      }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container *ngIf="editingIndex === i; else readModel">
                        <input
                          [(ngModel)]="item.manufacturerModel"
                          class="border rounded px-2 py-1 w-24"
                        />
                      </ng-container>
                      <ng-template #readModel>{{
                        item.manufacturerModel
                      }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container *ngIf="editingIndex === i; else readPart">
                        <input
                          [(ngModel)]="item.partNumber"
                          class="border rounded px-2 py-1 w-24"
                        />
                      </ng-container>
                      <ng-template #readPart>{{ item.partNumber }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container *ngIf="editingIndex === i; else readTerms">
                        <input
                          [(ngModel)]="item.terms"
                          class="border rounded px-2 py-1 w-24"
                        />
                      </ng-container>
                      <ng-template #readTerms>{{ item.terms }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container *ngIf="editingIndex === i; else readTrace">
                        <input
                          [(ngModel)]="item.traceabilityRequired"
                          class="border rounded px-2 py-1 w-24"
                        />
                      </ng-container>
                      <ng-template #readTrace>{{
                        item.traceabilityRequired
                      }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container
                        *ngIf="editingIndex === i; else readUnitPrice"
                      >
                        <input
                          type="number"
                          [(ngModel)]="item.unitPrice"
                          class="border rounded px-2 py-1 w-20"
                        />
                      </ng-container>
                      <ng-template #readUnitPrice>{{
                        item.unitPrice
                      }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      <ng-container
                        *ngIf="editingIndex === i; else actualUnitCost"
                      >
                        <input
                          type="number"
                          [(ngModel)]="item.unitPrice"
                          class="border rounded px-2 py-1 w-20"
                        />
                      </ng-container>
                      <ng-template #actualUnitCost>{{
                        item.actualCostPerUnit
                      }}</ng-template>
                    </td>
                    <td class="border px-2 py-1">
                      {{ item.totalPrice }}
                    </td>
                    <td class="border px-3 py-2">
                      <div class="flex items-center space-x-2">
                        <ng-container
                          *ngIf="editingIndex === i; else actionBtns"
                        >
                          <button
                            (click)="saveItem(item); cancelEdit()"
                            class="bg-green-500 text-white px-2 py-1 rounded"
                          >
                            Save
                          </button>
                          <button
                            (click)="cancelEdit()"
                            class="bg-gray-500 text-white px-2 py-1 rounded"
                          >
                            Cancel
                          </button>
                        </ng-container>
                        <ng-template #actionBtns>
                          <button
                            (click)="editItem(i)"
                            class="bg-green-500 text-white px-2 py-1 rounded"
                          >
                            Edit
                          </button>
                          <button
                            (click)="deleteItem(item)"
                            class="bg-red-500 text-white px-2 py-1 rounded"
                          >
                            Delete
                          </button>
                        </ng-template>
                      </div>
                    </td>
                  </tr>
                  <tr *ngIf="productItems?.length === 0">
                    <td
                      colspan="10"
                      class="border px-2 py-1 text-center text-gray-500"
                    >
                      No items found
                    </td>
                  </tr>
                </tbody>
                <tr>
                  <td
                    colspan="9"
                    class="border px-2 py-1 text-right font-semibold"
                  >
                    SUB TOTAL
                  </td>
                  <td class="border px-2 py-1">
                    {{ subTotal | currency : "USD" }}
                  </td>
                </tr>
                <tr>
                  <td
                    colspan="9"
                    class="border px-2 py-1 text-right font-semibold"
                  >
                    DISCOUNT
                  </td>
                  <td class="border px-2 py-1">$-</td>
                </tr>
                <tr>
                  <td
                    colspan="9"
                    class="border px-2 py-1 text-right font-semibold"
                  >
                    FREIGHT /SHIPPING
                  </td>
                  <td class="border px-2 py-1">$-</td>
                </tr>
                <tr>
                  <td
                    colspan="9"
                    class="border px-2 py-1 text-right font-semibold"
                  >
                    CUSTOM FEE /TAX
                  </td>
                  <td class="border px-2 py-1">$-</td>
                </tr>
                <tr>
                  <td
                    colspan="9"
                    class="border px-2 py-1 text-right font-semibold"
                  >
                    TOTAL AMOUNT
                  </td>
                  <td class="border px-2 py-1">
                    {{ total | currency : "USD" }}
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div *ngIf="loading">
          <p class="px-2 py-1 text-center text-gray-500">
            <span>Loading </span>
            <span class="loading-dots">
              <span class="dot">.</span>
              <span class="dot">.</span>
              <span class="dot">.</span>
            </span>
          </p>
        </div>
        <!-- Modal footer -->
        <div class="flex items-center p-6 space-x-2 rounded-b">
          <button
            type="button"
            class="text-gray-700 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-blue-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10"
            (click)="closeModel()"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
